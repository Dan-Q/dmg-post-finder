(()=>{"use strict";var e={n:t=>{var s=t&&t.__esModule?()=>t.default:()=>t;return e.d(s,{a:s}),s},d:(t,s)=>{for(var r in s)e.o(s,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:s[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.wp.blocks,s=window.wp.blockEditor,r=window.wp.components,n=window.wp.element,o=window.wp.apiFetch;var a=e.n(o);const i=window.wp.i18n,l=window.ReactJSXRuntime;(0,t.registerBlockType)("dmg/post-finder",{title:(0,i.__)("DMG Post Finder"),icon:"search",category:"widgets",attributes:{postId:{type:"number",default:null},postTitle:{type:"string",default:""},postUrl:{type:"string",default:""}},edit:({attributes:e,setAttributes:t})=>{const{postId:o,postTitle:c,postUrl:d}=e,[p,h]=(0,n.useState)(""),[u,_]=(0,n.useState)(!1),[g,m]=(0,n.useState)([]),[w,j]=(0,n.useState)(!0),[x,f]=(0,n.useState)(1),[y,v]=(0,n.useState)(1),S=(0,s.useBlockProps)();(0,n.useEffect)((()=>{k()}),[]);const b=(e="",t=1)=>(_(!0),new Promise(((s,r)=>{a()({path:"/dmg-post-finder/v1/search?search="+encodeURIComponent(e)+"&page="+t,method:"GET"}).then((e=>{m(e.posts),v(e.pages),_(!1),s(e)})).catch((e=>{console.error("Error searching posts: ",e),_(!1),r(e)}))}))),k=()=>{b()},P=()=>{f(1),b(p,x).then((()=>{j(!1)}))};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(s.InspectorControls,{children:(0,l.jsxs)(r.PanelBody,{title:(0,i.__)("Post Search"),children:[(0,l.jsx)(r.TextControl,{label:(0,i.__)("Search posts"),value:p,onChange:h,onKeyDown:e=>{"Enter"===e.key&&P()},placeholder:(0,i.__)("Search by title or ID…"),type:"search"}),(0,l.jsxs)("p",{children:[(0,l.jsx)(r.Button,{variant:"primary",onClick:P,disabled:u||!p,children:u?(0,i.__)("Searching…"):(0,i.__)("Search")}),u&&(0,l.jsx)(r.Spinner,{})]}),g.length>0&&(0,l.jsxs)("div",{className:"dmg-post-finder__search-results",children:[(0,l.jsx)("h3",{children:w?(0,i.__)("Recent Posts"):(0,i.__)("Search Results")}),(C=g,C&&0!==C.length?(0,l.jsx)("ul",{className:"dmg-post-finder__results",children:C.map((e=>(0,l.jsx)("li",{children:(0,l.jsx)(r.Button,{variant:"link",onClick:()=>(e=>{t({postId:e.id,postTitle:e.title,postUrl:e.url})})(e),children:e.title})},e.id)))}):(0,l.jsx)("p",{children:(0,i.__)("No posts found.")})),y>1&&(0,l.jsx)("div",{className:"dmg-post-finder__pagination",children:Array.from({length:y},((e,t)=>t+1)).map((e=>(0,l.jsx)(r.Button,{variant:e===x?"primary":"secondary",onClick:()=>{return t=e,_(!0),f(t),void a()({path:"/dmg-post-finder/v1/search?search="+encodeURIComponent(p)+"&page="+t,method:"GET"}).then((e=>{m(e.posts),v(e.pages),_(!1)})).catch((e=>{console.error("Error searching posts: ",e)}));var t},style:{margin:"0 4px"},children:e},e)))})]}),!u&&p&&0===g.length&&(0,l.jsx)("p",{children:(0,i.__)("No posts found.")})]})}),(0,l.jsx)("div",{...S,children:o?(0,l.jsxs)("p",{className:"dmg-read-more",children:["Read More: ",(0,l.jsx)("a",{href:d,children:c})]}):(0,l.jsx)(r.Placeholder,{icon:"search",label:(0,i.__)("DMG Post Finder"),instructions:(0,i.__)("Search for and select a post in the block settings.")})})]});var C},save:()=>null})})();