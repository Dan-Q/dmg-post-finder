(()=>{"use strict";var e={n:t=>{var s=t&&t.__esModule?()=>t.default:()=>t;return e.d(s,{a:s}),s},d:(t,s)=>{for(var r in s)e.o(s,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:s[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.wp.blocks,s=window.wp.blockEditor,r=window.wp.components,n=window.wp.element,o=window.wp.apiFetch;var a=e.n(o);const i=window.wp.i18n,l=window.ReactJSXRuntime;(0,t.registerBlockType)("dmg/post-finder",{title:(0,i.__)("DMG Post Finder"),icon:"search",category:"widgets",attributes:{postId:{type:"number",default:null},postTitle:{type:"string",default:""},postUrl:{type:"string",default:""}},edit:({attributes:e,setAttributes:t})=>{const{postId:o,postTitle:c,postUrl:d}=e,[p,h]=(0,n.useState)(""),[u,m]=(0,n.useState)(!1),[g,_]=(0,n.useState)([]),[x,j]=(0,n.useState)(!0),[w,y]=(0,n.useState)(1),[f,v]=(0,n.useState)(1),S=(0,s.useBlockProps)();(0,n.useEffect)((()=>{k()}),[]);const b=(e="",t=1)=>(m(!0),new Promise(((s,r)=>{a()({path:"/dmg-post-finder/v1/search?search="+encodeURIComponent(e)+"&page="+t,method:"GET"}).then((e=>{_(e.posts),v(e.pages),m(!1),s(e)})).catch((e=>{console.error("Error searching posts: ",e),m(!1),r(e)}))}))),k=()=>{b()},C=()=>{y(1),b(p,w).then((()=>{j(!1)}))},P=e=>{m(!0),y(e),a()({path:"/dmg-post-finder/v1/search?search="+encodeURIComponent(p)+"&page="+e,method:"GET"}).then((e=>{_(e.posts),v(e.pages),m(!1)})).catch((e=>{console.error("Error searching posts: ",e)}))},B=Math.min(f,w+3),E=Math.max(1,w-(B==f?2:1)),I=E>1,R=B<f;return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(s.InspectorControls,{children:(0,l.jsxs)(r.PanelBody,{title:(0,i.__)("Post Search"),children:[(0,l.jsx)(r.TextControl,{label:(0,i.__)("Search posts"),value:p,onChange:h,onKeyDown:e=>{"Enter"===e.key&&C()},placeholder:(0,i.__)("Search by title or ID…"),type:"search"}),(0,l.jsxs)("p",{children:[(0,l.jsx)(r.Button,{variant:"primary",onClick:C,disabled:u||!p,children:u?(0,i.__)("Searching…"):(0,i.__)("Search")}),u&&(0,l.jsx)(r.Spinner,{})]}),g.length>0&&(0,l.jsxs)("div",{className:"dmg-post-finder__search-results",children:[(0,l.jsx)("h3",{children:x?(0,i.__)("Recent Posts"):(0,i.__)("Search Results")}),(T=g,T&&0!==T.length?(0,l.jsx)("ul",{className:"dmg-post-finder__results",children:T.map((e=>(0,l.jsx)("li",{children:(0,l.jsx)(r.Button,{variant:"link",onClick:()=>(e=>{t({postId:e.id,postTitle:e.title,postUrl:e.url})})(e),children:e.title})},e.id)))}):(0,l.jsx)("p",{children:(0,i.__)("No posts found.")})),f>1&&(0,l.jsxs)("div",{className:"dmg-post-finder__pagination",children:[I&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(r.Button,{variant:1===w?"primary":"secondary",onClick:()=>P(1),style:{margin:"0 4px"},children:"1"},1),(0,l.jsx)("span",{children:"…"})]}),Array.from({length:B-E},((e,t)=>t+E)).map((e=>(0,l.jsx)(r.Button,{variant:e===w?"primary":"secondary",onClick:()=>P(e),style:{margin:"0 4px"},children:e},e))),R&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("span",{children:"…"}),(0,l.jsx)(r.Button,{variant:f===w?"primary":"secondary",onClick:()=>P(f),style:{margin:"0 4px"},children:f},f)]})]})]}),!u&&p&&0===g.length&&(0,l.jsx)("p",{children:(0,i.__)("No posts found.")})]})}),(0,l.jsx)("div",{...S,children:o?(0,l.jsxs)("p",{className:"dmg-read-more",children:["Read More: ",(0,l.jsx)("a",{href:d,children:c})]}):(0,l.jsx)(r.Placeholder,{icon:"search",label:(0,i.__)("DMG Post Finder"),instructions:(0,i.__)("Search for and select a post in the block settings.")})})]});var T},save:()=>null})})();